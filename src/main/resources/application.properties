# Puerto de la aplicación
server.port=5001

# URLs de las APIs existentes
api.product.similarids.url=http://localhost:3001/product/{productId}/similarids
api.product.detail.url=http://localhost:3001/product/{productId}

# Configuración de WebClient
spring.codec.max-in-memory-size=10MB
webclient.max-connections=1000
webclient.acquisition-timeout=1500
webclient.max-idle-time=15000
webclient.evict-interval=2000
webclient.connect-timeout=1000
webclient.response-timeout=2000
webclient.read-timeout=2000
webclient.write-timeout=2000
webclient.max-memory-size=16777216

# Configuración avanzada de Netty
webclient.netty.selector-threads=2
webclient.netty.worker-threads=8
reactor.netty.ioWorkerCount=8
reactor.netty.pool.leasingStrategy=lifo
spring.application.netty.connection.provider.max-life-time=30000

# Configuración servidor Netty
server.netty.connection.backlog=8192
server.netty.connection.timeout=15000
server.netty.worker.count=16
server.netty.boss.count=4

# Configuración de Reactor
reactor.schedulers.defaultBoundedElasticSize=200
reactor.schedulers.defaultBoundedElasticQueueSize=200000

# Optimizaciones JVM
spring.jvm.gc.overhead=5
spring.jvm.heap.size=512m

# Configuración de caché
cache.expiration=600
cache.maximum-size=25000
spring.cache.caffeine.spec=maximumSize=25000,expireAfterWrite=600s,recordStats=true

# Configuración de circuit breaker
resilience4j.circuitbreaker.instances.productApi.sliding-window-size=20
resilience4j.circuitbreaker.instances.productApi.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.productApi.wait-duration-in-open-state=2000ms
resilience4j.circuitbreaker.instances.productApi.failure-rate-threshold=40
resilience4j.circuitbreaker.instances.productApi.register-health-indicator=true
resilience4j.circuitbreaker.instances.productApi.allow-health-indicator-to-fail=true
resilience4j.circuitbreaker.instances.productApi.automatic-transition-from-open-to-half-open-enabled=true

# Resilience4j
resilience4j.retry.instances.productApi.max-attempts=2
resilience4j.retry.instances.productApi.wait-duration=500ms
resilience4j.retry.instances.productApi.retry-exceptions=java.io.IOException,java.util.concurrent.TimeoutException

# Configuraciones de timeouts
spring.mvc.async.request-timeout=15000ms

# Configuraciones de monitoreo
management.endpoints.web.exposure.include=health,info,metrics,prometheus,circuitbreakers
management.prometheus.metrics.export.enabled=true
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
